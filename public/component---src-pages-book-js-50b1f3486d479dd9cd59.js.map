{"version":3,"sources":["webpack://jotter/./src/hooks/useFetchMongoField.js","webpack://jotter/./src/components/Book/ReadingProgress.js","webpack://jotter/./src/components/Note/Note.js","webpack://jotter/./src/pages/book.js"],"names":["user","id","fetchFunction","useState","hasFetched","setHasFetched","data","setData","error","setError","useEffect","email","result","message","fetchData","Container","styled","Info","Title","ProgressBar","Description","Modal","props","out","fadeOut","fadeIn","keyframes","Input","Label","UpdateButton","Submit","percentage","isbn","isOpen","setIsOpen","outside","useRef","progress","setProgress","inputValue","setInputValue","document","addEventListener","e","current","contains","target","ref","value","max","handlePercentage","onClick","placeholder","onChange","preventDefault","updatePercentageRead","then","success","generalError","specificError","NoteContainer","Wrapper","Link","Date","title","date","noteID","bookID","to","AddNoteButton","NoNotesMessage","location","useAuth0","queryString","search","useFetchGoogleBook","book","fetchedBook","useFetchMongoField","getPercentageRead","read","fetchedPercentageRead","getNotes","notes","fetchedNotes","Layout","header","subheader","BookContainer","cover","author","desc","category","length","avgRating","ratings","language","username","deleteButton","redirectAfterDelete","console","log","minHeight","Loading","src","LoadingIcon","alt","className","state","color","map","note","Note","noteTitle","key","_noteID"],"mappings":"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","file":"component---src-pages-book-js-50b1f3486d479dd9cd59.js","sourcesContent":["import { useState, useEffect } from \"react\";\n\nconst useFetchMongoField = (user, id, fetchFunction) => {\n  const [hasFetched, setHasFetched] = useState(false);\n  const [data, setData] = useState(null);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      if (!user) return;\n      try {\n        let result = await fetchFunction(user.email, id);\n        setData(result);\n        setHasFetched(true);\n      } catch (error) {\n        setError(error.message);\n      }\n    };\n\n    if (data === null) {\n      fetchData();\n    }\n\n \n  }, [user, id, fetchFunction, data]);\n\n  return { data, hasFetched, error };\n};\n\nexport default useFetchMongoField;\n","import React, { useState, useRef, useEffect } from \"react\";\nimport styled, { keyframes } from \"styled-components\";\nimport { updatePercentageRead } from \"../../services/realm/API\";\nimport {\n  generalError,\n  specificError,\n  success,\n} from \"../Notification & Error/Notifications\";\n\nconst Container = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  flex: 1;\n  flex-grow: 1;\n  row-gap: 1rem;\n  justify-content: space-between;\n  align-items: center;\n  background-color: #fdfdfd;\n  padding: 0.8rem 1.8rem;\n  border: var(--gray-border);\n  border-radius: var(--round);\n`;\n\nconst Info = styled.div`\n  flex-grow: 0.7;\n`;\n\nconst Title = styled.h5`\n  font-size: 1.3rem;\n  color: #333;\n  margin-bottom: 0.5rem;\n  margin-top: 0;\n`;\n\nconst ProgressBar = styled.progress`\n  appearance: none;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  overflow: hidden;\n  height: 0.7rem;\n  width: 100%;\n  background-color: #c4f1d8; // firefox\n  border-radius: var(--round);\n\n  &::-webkit-progress-bar {\n    background-color: #c4f1d8;\n  }\n\n  &::-webkit-progress-value {\n    background-color: #3aae5b;\n  }\n\n  &::-moz-progress-bar {\n    background-color: #3aae5b;\n  }\n`;\n\nconst Description = styled.p`\n  color: #3aae5b;\n  font-weight: 700;\n  margin-top: 0.5rem;\n  margin-bottom: 0;\n`;\n\nconst Modal = styled.div`\n  display: flex;\n  justify-content: space-between;\n  float: right;\n  background-color: #fdfdfd;\n  padding: 0.8rem 1.8rem;\n  margin-top: 0.5rem;\n  border: var(--gray-border);\n  box-shadow: var(--general-shadow);\n  visibility: ${(props) => (props.out ? \"hidden\" : \"visible\")};\n  animation: ${(props) => (props.out ? fadeOut : fadeIn)} 0.1s linear;\n  transition: visibility 0.1s linear;\n`;\n\nconst fadeIn = keyframes`\n  from {\n    transform: scale(0.25);\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(1);\n    opacity: 1;\n  }\n`;\n\nconst fadeOut = keyframes`\n  from {\n    transform: scale(1);\n    opacity: 1;\n  }\n\n  to {\n    transform: scale(.25);\n    opacity: 0;\n  }\n`;\n\nconst Input = styled.input`\n  border: var(--gray-border);\n  font-weight: bold;\n  font-size: 1rem;\n  text-align: center;\n  max-width: 5rem;\n  color: gray;\n\n  ::placeholder {\n    text-align: center;\n    color: darkgray;\n  }\n`;\n\nconst Label = styled.label`\n  align-self: center;\n  margin-left: 0.3rem;\n  margin-right: 1rem;\n  color: #949494;\n  font-weight: 600;\n`;\n\nconst UpdateButton = styled.button`\n  background-color: transparent;\n  border: 2px solid #888;\n  color: #888;\n  font-size: 1rem;\n  font-weight: bold;\n  padding: 0.4rem 0.7rem;\n\n  &:hover {\n    border: 2px solid #555;\n    color: #555;\n  }\n`;\n\nconst Submit = styled.button`\n  background-color: transparent;\n  border: 2px solid #3aae5b;\n  color: #3aae5b;\n  font-weight: bold;\n  font-size: 1rem;\n  padding: 0.4rem 0.7rem;\n  margin-left: 1rem;\n\n  &:hover {\n    border: 2px solid #31944d;\n    color: #31944d;\n  }\n`;\n\nconst ReadingProgress = ({ percentage, user, isbn }) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const outside = useRef();\n  const [progress, setProgress] = useState(percentage);\n  const [inputValue, setInputValue] = useState(\"\");\n  const onChange = (e) => {\n    setInputValue(e.target.value);\n  };\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    updatePercentageRead(user, isbn, inputValue).then(\n      () => {\n        setIsOpen(false);\n        setProgress(inputValue);\n        setInputValue(\"\");\n        success(\"Your reading progress has been updated\");\n      },\n      (error) => {\n        if (error === 400) {\n          generalError(\n            \"Invalid request: Couldn't update your reading progress.\"\n          );\n        } else {\n          specificError(\n            error,\n            \"Something went wrong. Check your internet connection and try again.\"\n          );\n        }\n      }\n    );\n  };\n\n  useEffect(() => {\n    const handleClick = (e) => {\n      if (!outside?.current?.contains(e.target)) {\n        setIsOpen(false);\n        setInputValue(\"\");\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClick);\n  }, [outside, progress]);\n\n  function handlePercentage(progress) {\n    if (progress === \"0\") {\n      return \"Not read\";\n    } else if (progress === \"100\") {\n      return \"Completed\";\n    } else {\n      return `${progress}% read`;\n    }\n  }\n  return (\n    <div ref={outside}>\n      <Container>\n        <Info>\n          <Title>Reading Progress</Title>\n          <ProgressBar value={progress} max=\"100\" />\n          <Description>{handlePercentage(progress)}</Description>\n        </Info>\n        <UpdateButton onClick={() => setIsOpen(!isOpen)}>Update</UpdateButton>\n      </Container>\n      <Modal out={!isOpen}>\n        <Input placeholder={progress} onChange={onChange} value={inputValue} />\n        <Label>%</Label>\n        <Submit onClick={handleSubmit}>Submit</Submit>\n      </Modal>\n    </div>\n  );\n};\n\nexport default ReadingProgress;\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { Link } from \"gatsby\";\n\nexport const NoteContainer = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  margin-top: 3rem;\n  gap: 1rem;\n`;\n\nconst Wrapper = styled(Link)`  \n  padding: 1rem;\n  border: var(--purple-border);\n  border-radius: var(--round);\n\n  &:hover {\n    border: var(--purple-border-hover);\n  }\n`;\n\nconst Title = styled.h5`\n  color: #4C3E67;\n  font-size: 1.3rem;\n  font-weight: 600;\n  margin: 0;\n  max-width: 25rem;\n`;\nconst Date = styled.h6`\n  color: #4C3E67;\n  font-size: 0.9rem;\n  font-weight: normal;\n  margin-top: 1rem;\n  margin-bottom: 0;\n`;\n\nconst NoteBlock = ({ title, date, noteID, bookID }) => {\n  return (\n    <Wrapper\n      to={`/note?book=${bookID}&note=${noteID}`}\n    >\n      <Title>{title}</Title>\n      <Date>{date}</Date>\n    </Wrapper>\n  );\n};\n\nexport default NoteBlock;\n","import React from \"react\";\nimport Layout from \"../components/Page/Layout\";\nimport { useAuth0 } from \"@auth0/auth0-react\";\nimport LoadingIcon from \"../assets/loading.svg\";\nimport { BookContainer } from \"../components/Book/BookContainer\";\nimport { Wrapper, Loading } from \"../components/Notification & Error/Loading\";\nimport useFetchGoogleBook from \"../hooks/useFetchGoogleBook\";\nimport useFetchMongoField from \"../hooks/useFetchMongoField\";\nimport { getPercentageRead, getNotes } from \"../services/realm/API\";\nimport ReadingProgress from \"../components/Book/ReadingProgress\";\nimport Header from \"../components/Page/Headings\";\nimport { Link } from \"gatsby\";\nimport styled from \"styled-components\";\nimport NoteBlock, { NoteContainer } from \"../components/Note/Note\";\nimport { AddIcon } from \"../components/Buttons/Icons\";\nimport { RedirectHome } from \"../components/Routing\";\nimport * as queryString from \"query-string\";\n\nconst AddNoteButton = styled(Link)`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  column-gap: 0.3rem;\n  background-color: white;\n  color: #6b6b6b;\n  font-weight: bold;\n  padding: 0.5rem 1rem;\n  border: var(--gray-border);\n  box-shadow: var(--general-shadow);\n\n  &:hover {\n    border: var(--gray-border-hover);\n    color: #555;\n  }\n`;\n\nconst NoNotesMessage = styled.h3`\n  color: #888;\n  font-weight: normal;\n  font-size: 1.3rem;\n  margin: 2rem auto;\n`;\n\nconst Book = ({ location }) => {\n  const { user } = useAuth0();\n  const isbn = queryString.parse(location.search).id;\n\n  const { data: book, hasFetched: fetchedBook } = useFetchGoogleBook(isbn);\n  const { data: read, hasFetched: fetchedPercentageRead } = useFetchMongoField(\n    user,\n    isbn,\n    getPercentageRead\n  );\n  const { data: notes, hasFetched: fetchedNotes } = useFetchMongoField(\n    user,\n    isbn,\n    getNotes\n  );\n\n  if (isbn === null) {\n    return <RedirectHome />;\n  }\n  return (\n    <Layout>\n      <Header header=\"Book\" subheader=\"In your library\" />\n\n      {fetchedBook && fetchedPercentageRead && (         \n        <BookContainer\n          cover={book.cover}\n          title={book.title}\n          author={book.author}\n          date={book.date}\n          desc={book.desc}\n          category={book.category}\n          length={book.length}\n          avgRating={book.avgRating}\n          ratings={book.ratings}\n          language={book.language}\n          isbn={book.isbn}\n          username={user.email}\n          deleteButton={true}\n          redirectAfterDelete={\"/\"}\n        >\n          <ReadingProgress\n            percentage={read}\n            isbn={book.isbn}\n            user={user.email}\n          />\n          {console.log(\"FETCHED BOOK\")}       \n          {console.log(\"FETCHED PERCENTAGE\")}\n        </BookContainer>        \n      )}\n\n      {!fetchedBook && (\n        <Wrapper minHeight=\"50vh\">\n          <Loading\n            minHeight=\"30vh\"\n            src={LoadingIcon}\n            alt=\"Loading icon\"\n            className=\"rotating\"\n          />\n        </Wrapper>\n      )}\n      <Header header=\"Notes\" subheader=\"All your notes on this book\">\n        <AddNoteButton\n          to=\"/add-note\"\n          state={{\n            isbn: isbn,\n            user: user,\n          }}\n        >\n          <AddIcon color=\"#6b6b6b\" />\n          Add Note\n        </AddNoteButton>\n      </Header>\n      {fetchedNotes && (\n        <NoteContainer>\n          {notes.map((note) => {\n            return (\n              <NoteBlock\n                title={note.noteTitle}\n                date={note.date}\n                key={note._noteID}\n                noteID={note._noteID}\n                bookID={isbn}\n              />\n            );\n          })}\n          {console.log(\"NOTE FETCHED\", notes)}\n          {notes.length === 0 && (\n            <NoNotesMessage>\n              You don't have any notes for this book yet.\n            </NoNotesMessage>\n          )}\n        </NoteContainer>\n      )}\n    </Layout>\n  );\n};\n\nexport default Book;\n"],"sourceRoot":""}